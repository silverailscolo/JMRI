<!DOCTYPE html>
<html lang="en">
<head>
  <title>JMRI: Dispatcher System</title>
  <!--#include virtual="/help/en/parts/Style.shtml" -->
</head>
<body>
<!--#include virtual="/help/en/parts/Header.shtml" -->
<div id="mBody">
  <div id="mainContent" class="no-sidebar">
    <!--    <p>JMRI: Dispatcher System</p>-->
    <div>
      <h1><a name="_Toc192448847"></a>Dispatcher System</h1>
      <ul>
        <!--        <li><a href="#_Toc192448847">Dispatcher System</a></li>-->
        <li><a href="#_Toc192448848">Stages in Setting up the System</a></li>
        <ul>
          <li><a href="#_Toc192448849">Stage 1</a></li>
          <li><a href="#_Toc192448850">Stage 2</a></li>
          <li><a href="#_Toc192448851">Prerequisites - Details</a></li>
          <li><a href="#_Toc192448852">Setting Up the Dispatcher System - Details</a></li>
          <ul>
            <li><a href="#_Toc192448853">Running Stage1 &mdash; Editing the panel and producing the transits</a></li>
            <li><a href="#_Toc192448854">Running Stage2 Final Checks</a></li>
          </ul>
          <li><a href="#_Toc192448855">Starting the Program</a></li>
          <ul>
            <li><a href="#_Toc192448856">Starting the Program</a></li>
          </ul>
        </ul>
        <li><a href="#_Toc192448857">Running the System</a></li>
        <ul>
          <li><a href="#_Toc192448858">Setup or Register a Train</a></li>
          <ul>
            <li><a href="#_Toc192448859">Setup two or more trains at once</a></li>
            <li><a href="#_Toc192448860">Saving and Retrieving Results from File</a></li>
            <li><a href="#_Toc192448861">Modify existing trains</a></li>
          </ul>
          <li><a href="#_Toc192448862">Dispatch or run a train directly</a></li>
          <ul>
            <li><a href="#_Toc192448863">Example: Run a train between two stops (stations)</a></li>
          </ul>
        </ul>
        <li><a href="#_Toc192448864">Routes</a></li>
        <ul>
          <li><a href="#_Toc192448865">Setup a Route</a></li>
          <li><a href="#_Toc192448866">View/Edit Routes</a></li>
          <ul>
            <li><a href="#_Toc192448867">View Routes</a></li>
            <li><a href="#_Toc192448868">Editing the route</a></li>
          </ul>
          <ul>
            <li><a href="#_Toc192448869">Run Route</a></li>
          </ul>
          <li><a href="#_Toc192448870">Run One Route</a></li>
          <li><a href="#_Toc192448871">Run Several Routes at Once</a></li>
        </ul>
        <li><a href="#_Toc192448872">Modifying the Behaviour of Running Trains</a></li>
        <ul>
          <li><a href="#_Toc192448873">Set Stopping Length</a></li>
          <ul>
            <li><a href="#_Toc192448874">Modify All Stopping Distances</a></li>
            <li><a href="#_Toc192448875">Modify Stopping Distance on one Transit</a></li>
          </ul>
          <li><a href="#_Toc192448876">Set Stop Sensor</a></li>
          <li><a href="#_Toc192448877">Set Station Wait Time</a></li>
          <ul>
            <li><a href="#_Toc192448878">Modify all station wait times</a></li>
            <li><a href="#_Toc192448879">Modify the wait time at a particular station approach</a></li>
          </ul>
          <li><a href="#_Toc192448880">Set Station Direction</a></li>
          <ul>
            <li><a href="#_Toc192448881">Setting Station Direction at a Station</a></li>
            <li><a href="#_Toc192448882">Setting the Station Direction using a block</a></li>
          </ul>
          <li><a href="#_Toc192448883">Restrict Transit Operation</a></li>
          <ul>
            <li><a href="#_Toc192448884">Introduction</a></li>
            <li><a href="#_Toc192448885">Creating the required Rule</a></li>
          </ul>
        </ul>
        <li><a href="#_Toc192448886">Scheduling</a></li>
        <ul>
          <li><a href="#_Toc192448887">Adding Schedules</a></li>
          <li><a href="#_Toc192448888">To save the set of scheduled trains</a></li>
          <li><a href="#_Toc192448889">To retrieve a set of scheduled trains</a></li>
        </ul>
        <li><a href="#_Toc192448890">Setting Departure Times</a></li>
        <ul>
          <li><a href="#_Toc192448891">Setting Departure Times Manually</a></li>
          <li><a href="#_Toc192448892">Setting Departure Times Automatically</a></li>
        </ul>
        <li><a href="#_Toc192448893">Set Wait Time in Stations</a></li>
        <li><a href="#_Toc192448894">Run Train on Route to Set Journey Times</a></li>
        <li><a href="#_Toc192448895">Run Scheduled Trains</a></li>
        <ul>
          <li><a href="#_Toc192448896">Initialisation: Change Running Period Parameters</a></li>
          <li><a href="#_Toc192448897">Start the Scheduled Trains</a></li>
          <ul>
            <li><a href="#_Toc192448898">1) Set the time to a period within the running period</a></li>
            <li><a href="#_Toc192448899">2) Start the scheduling of the trains</a></li>
            <li><a href="#_Toc192448900">3) Start the clock</a></li>
          </ul>
          <li><a href="#_Toc192448901">Stop Scheduling Trains</a></li>
        </ul>
        <li><a href="#_Toc192448902">Timetables</a></li>
        <ul>
          <li><a href="#_Toc192448903">Set Platforms and Station Groups</a></li>
          <li><a href="#_Toc192448904">Local Timetables</a></li>
          <li><a href="#_Toc192448905">Turning Timetables Off</a></li>
          <li><a href="#_Toc192448906">Remote Timetables triggered by MQTT</a></li>
          <ul>
            <li><a href="#_Toc192448907">Generating the MQTT Node Red code</a></li>
            <li><a href="#_Toc192448908">Setting up the required Node Red environment</a></li>
            <li><a href="#_Toc192448909">Setup a MQTT Connection in JMRI</a></li>
            <li><a href="#_Toc192448910">Display the MQTT timetable</a></li>
          </ul>
        </ul>
        <li><a href="#_Toc192448911">Adding New Stations or Track to a Completed Panel</a></li>
      </ul>
      <p>This is an automated system designed to enable you to run trains using the Dispatcher system between locations
        (normally sidings or stations, but really any set of blocks) designated by yourself.</p>
      <p>Provided you have set up a system as described in System Requirements, by pressing a few buttons on theSystem
        Generation Panel, a complete system will be set up for you complete with Transits, Train Info files, and buttons
        for you to press which will route trains across your layout.</p>
      <p>A network will be set up behind the scenes which will find the best route from the train's location to the
        required location, and set in place a set of transits which will guide the train to the required location.</p>
      <p>The train will either stop at all stations on the route, or travel without stopping at intermediate stops,
        depending on whether express or stopping mode is selected</p>
      <p>Provision is made for multiple train operation, the trains stopping for each other. This is a feature of
        Dispatcher, but the system allows easy selecting of each train to control each one.</p>
      <h2><a name="_Toc167983231"></a><a name="_Toc168507346"></a><a name="_Toc192448848"></a>Stages in Setting up the
        System</h2>
      <p>There are two stages to set up the system for automatic train running:</p>
      <h3><a name="_Toc192448849"></a>Stage 1</h3>
      <p>Fulfil the prerequisites, which include having speed profiled your locos that you wish to run with the
        system</p>
      <ul type="disc">
        <li>Start JMRI with a panel loaded.</li>
        <li>The panel should have:</li>
      </ul>
      <ul type="disc">
        <ul type="circle">
          <li>SignalMasts. Do not use Signal Heads. This is an alternative way of setting up signals and Dispatcher
            system will not work with them.
          </li>
          <li>Signal Masts should be placed on all potential section boundaries.</li>
          <li>No Sections. Sections will be created using the signals, and any existing sections will be deleted.</li>
          <li>No SignalMast Logic (if there is any they will be deleted and replaced)</li>
          <li>No Transits (if there are any they will be deleted and replaced)</li>
          <li>No Train Info Files (if there are any they will be deleted and replaced)<br/> <br/></li>
        </ul>
      </ul>
      <p>In other words there is a lot of stuff that you would ordinarily need to set up to use Dispatcher, that you don&rsquo;t
        need to using Dispatcher System</p>
      <p>In addition the block table should have been edited to indicate the blocks where the train should stop</p>
      <p>o These requirements are explained in detail below.</p>
      <p>You will be using sensors and Signal Masts. In order for these to work properly, people usually set up a start
        of day operation. As a quick way of getting the system working you can put two routines in the startup file in
        properties, which can be found in the scripts area</p>
      <p>&middot; SetAllTurnoutsClosed.py and</p>
      <p>&middot; SetAllUnknownSensorsToInactive </p>
      <p>If you use these be sure to load the panel before calling these in the startup routines, else they will not
        work. It is also useful to put a button on the startup screen calling the dispatcher system file in the same
        directory</p>
      <p>&middot; DispatcherSystem.py</p>
      <p><img src="DispatcherSystem_files/image001.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="961" height="207" border="0"/></p>
      <h3><a name="_Toc192448850"></a>Stage 2</h3>
      <p> To run Dispatcher System:</p>
      <ul type="disc">
        <li>Bring up the Dispatcher System Panel</li>
        <li>Run Stage1 to generate everything to run Dispatcher between stations</li>
        <li>Run Stage2 to check the dispatcher options</li>
        <li>Run the trains using the commands on a newly produced command panel</li>
      </ul>
      <h2><a name="_Toc192448851"></a><a name="_Toc168507347"></a>Prerequisites - Details</h2>
      <p>To use the Dispatcher System there are several prerequisites</p>
      <ul type="disc">
        <li>You should have set up the system with signal masts.</li>
        <li>The locos you want to run on the system should be:</li>
      </ul>
      <ul type="disc">
        <ul type="circle">
          <li>entered in the Roster</li>
          <li>set up with a speed profile</li>
        </ul>
      </ul>
      <ul type="disc">
        <li>the required stopping places (blocks) should be indicated by entering stop in the comments field for the
          appropriate block
        </li>
        <li>Provision is made for a station announcement to be made when a train enters a station.</li>
        <li>If the block name is unpronounceable, a good stop name can be entered in the comments field for the
          departure announcements
        </li>
        <li>Typical blocks comments would be</li>
      </ul>
      <p><img src="DispatcherSystem_files/image002.png"  width="1059" height="377" border="0"/></p>
      <h2><a name="_Toc168507348"></a><a name="_Toc192448852"></a>Setting Up the Dispatcher System - Details</h2>
      <h3><a name="_Toc162537046"></a><a name="_Toc167983233"></a><a name="_Toc168507349"></a><a
              name="_Toc192448853"></a>Running Stage1 &mdash; Editing the panel and producing the transits</h3>
      <p>Run DispatcherSystem.py in the main jython directory. You will get something like this:</p>
      <p><img src="DispatcherSystem_files/image003.png"  width="681" height="288" border="0"/></p>
      <p>You are prompted to run Stage1 which adds all the icons required to run the system on a new pane, and generates
        transits</p>
      <p>If the old panel name was WR.xml, the new panel will be backed up to WR_backup_xx.xml where _xx is an
        incremental number which is added if previous backups exist</p>
      <p>Some checks are done first, we check that:</p>
      <ul type="disc">
        <li>All blocks have a sensor</li>
        <li>No two blocks have the same sensor</li>
        <li>stops are set up</li>
        <li>all blocks have lengths</li>
      </ul>
      <p>If all checks pass we get a message:</p>
      <p><img src="DispatcherSystem_files/image004.png" alt="A screenshot of a computer screen
Description automatically generated" width="454" height="133" border="0"/></p>
      <p>Further details of the checks can be viewed if required. If the checks do not pass details of the errors are
        given.</p>
      <p>If no trains are present in the roster with speed profiles, this will be picked up at run time, and can be
        corrected then.</p>
      <p>The following items are then produced automatically, with countdown timer showing the progression</p>
      <p>&middot;A backup of the existing panel </p>
      <p>&middot; The changes to the panel with the stopping points and stopping sensors </p>
      <p>&middot;&nbsp;The signal logic to operate the signals </p>
      <p>&middot;&nbsp;The required sections </p>
      <p>&middot;&nbsp;The transits and train info files required to move trains between stopping points </p>
      <p><img src="DispatcherSystem_files/image005.png" alt="A screenshot of a computer error
Description automatically generated" width="474" height="158" border="0"/></p>
      <p>It is recommended that the panel is saved after testing. The current filename can be used if desired as a
        backup has been done automatically.</p>
      <h3><a name="_Toc162537047"></a><a name="_Toc167983234"></a><a name="_Toc168507350"></a><a
              name="_Toc192448854"></a>Running Stage2 Final Checks</h3>
      <p><img src="DispatcherSystem_files/image003.png"  width="681" height="288" border="0"/></p>
      <p>Click Stage2 and one gets two screens, one opening the Dispatcher options screen and another saying the options
        that need to be set for the Dispatcher system to work</p>
      <p><img src="DispatcherSystem_files/image006.png"  width="409" height="749" border="0"/></p>
      <p><img src="DispatcherSystem_files/image007.png"  width="399" height="246" border="0"/></p>
      <p>Set the required option and we get a message reminding you to save the changed options</p>
      <p><img src="DispatcherSystem_files/image008.png" alt="A screenshot of a computer error
Description automatically generated" width="406" height="142" border="0"/></p>
      <p>Select the dispatcher window that has opened automatically and click =&gt; Save Options</p>
      <p><img src="DispatcherSystem_files/image009.png"  width="159" height="154" border="0"/></p>
      <h2><a name="_Toc162537048"></a><a name="_Toc167983235"></a><a name="_Toc168507351"></a><a
              name="_Toc192448855"></a>Starting the Program</h2>
      <p>The program needs to be started. The program is a Jython script, which is started from the Dispatcher System
        Window which has been produced in the previous stages.</p>
      <h3><a name="_Toc168507352"></a><a name="_Toc192448856"></a>Starting the Program</h3>
      <p>You will notice several buttons in the top RH corner.</p>
      <p><img src="DispatcherSystem_files/image010.png" alt="" width="285" height="587" border="0"/></p>
      <p>The first two (run and stop dispatcher system) start and end the threads required for the program to run. The
        threads need to be in operation for the other buttons to work. </p>
      <p>While operating the dispatcher system, if you have the thread monitor running (Panels =&gt; Thread Monitor) you
        can monitor what processes are running.</p>
      <p>The thread monitor will look like the following once the system is started</p>
      <p><img src="DispatcherSystem_files/image011.png" alt="A screenshot of a computer monitor
AI-generated content may be incorrect." width="448" height="307" border="0"/></p>
      <p>Press the run button. The following screen appears</p>
      <p><img src="DispatcherSystem_files/image012.png" alt="" width="271" height="157" border="0"/></p>
      <p>Press OK, and wait for the Express Train and the Run Dispatch options to be highlighted and the run Dispatch
        option will cause the following prompt to be displayed:</p>
      <p><img src="DispatcherSystem_files/image013.png" alt="" width="285" height="588" border="0"/></p>
      <h2><a name="_Toc167983236"></a><a name="_Toc168507353"></a><a name="_Toc192448857"></a>Running the System</h2>
      <p>To run the system the following needs to be set up</p>
      <ol start="1" type="1">
        <li>Place a train on the layout. If you wish to simulate the train to get an idea of how the system will operate
          click the bottom left button of a station which will make the station occupied.
        </li>
        <li><strong>Register the train</strong> with the dispatcher system telling the system what way it&rsquo;s facing
          so the system knows what transit to use to move the train (forwards or backwards). Press the 'Setup Train in
          Section' button to do this.
        </li>
        <li><strong>Run the train.</strong> This can be done in several ways.</li>
      </ol>
      <ol start="3" type="1">
        <ol start="1" type="1">
          <li><strong>Setup a Dispatch</strong>. Click the Run Dispatch Button and click a station button and specify
            which registered train will move towards that station
          </li>
          <li><strong>Setup a Route</strong> and run the route. A Route consists of a path joining several stations. The
            stations joined can be anywhere on the layout no matter how far apart they are, and the system will find
            valid paths between the stations. The station buttons can be used to either set up a dispatch or set up a
            route depending upon whether "Setup Route or "Run Dispatch" is selected. The route is run by pressing the
            "Run Route" button.
          </li>
          <li>Setup routes, Setup Scheduled Trains and then start the scheduler.</li>
        </ol>
      </ol>
      <ol start="4" type="1">
        <li>If a physical train is on the layout at the start of the dispatch the train should move. If you have just
          made the block occupied with no physical train you can press the 'Simulate the Dispatched Train' button to get
          an idea of how the train will run. The train will simulate much quicker than a real train and takes no account
          of the train length.
        </li>
        <li>Announcements can be activated by pressing the 'Enable Announcements' button. This is off by default as they
          can get a but irritating.
        </li>
      </ol>
      <p>We go over each of these stages in detail below:</p>
      <h3><a name="_Toc162537049"></a><a name="_Toc167983237"></a><a name="_Toc168507354"></a><a
              name="_Toc192448858"></a>Setup or Register a Train</h3>
      <p>The first step is to register a train in a siding or at a stop. If you are simulating the system to see whether
        it will work before running trains you may press the bottom left hand small button which will make the section
        occupied. Drive a train to the required stop, and press Setup Train in Siding.</p>
      <p>We need to tell the system which way the train is pointing.</p>
      <ul type="disc">
        <li>At a siding it's easy there is one direction the train can go, and we say which way it is facing out of the
          siding
        </li>
        <li>At another stop we have to indicate which way we are talking about and we highlight one direction</li>
      </ul>
      <p>suppose we have the following layout with a train in Siding One</p>
      <p><img src="DispatcherSystem_files/image014.png" alt="A diagram of a train
Description automatically generated" width="655" height="301" border="0"/></p>
      <p>Choosing the Train</p>
      <p>We click &ldquo;Setup Train in Section&rdquo;</p>
      <p><img src="DispatcherSystem_files/image015.png"  width="279" height="212" border="0"/></p>
      <p>If the train is Siding One as indicated one gets the following message</p>
      <p><img src="DispatcherSystem_files/image016.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="697" height="119" border="0"/></p>
      <p>A facility exists to set up several trains at once. Assume for now we are setting up just one train. Click the
        1 train button.</p>
      <p>A dropdown with the blocks containing trains that have not been assigned. Choose the block you wish to assign a
        train to.</p>
      <p><img src="DispatcherSystem_files/image017.png"  width="262" height="120" border="0"/></p>
      <p>You get a list of unassigned trains with speed profiles.</p>
      <p><img src="DispatcherSystem_files/image018.png"  width="260" height="255" border="0"/></p>
      <p>Select the train that is in the block selected (in our case Siding One)</p>
      <p>Register the Direction the train is facing.</p>
      <p>A block next to the selected block will be highlighted:</p>
      <p><img src="DispatcherSystem_files/image019.png" alt="A diagram of a train
Description automatically generated" width="679" height="294" border="0"/></p>
      <p>The following message then pops up</p>
      <p><img src="DispatcherSystem_files/image020.png"  width="266" height="140" border="0"/></p>
      <p>Select the correct direction and click OK.</p>
      <p>The train will appear in the memory location for the block.</p>
      <p>A message giving the default length of the train will appear in scale metres and the equivalent for the scale
        chosen in cm and inches. Note the scale is set in Preferences:Warrants:</p>
      <p><img src="DispatcherSystem_files/image021.png" alt="A screenshot of a math test
Description automatically generated" width="274" height="148" border="0"/></p>
      <p>Set the length of the train to the actual length. This will be used to stop the train accurately.</p>
      <p>A message giving the speed factor of the train. If the train runs too slowly increase the speed factor, if it
        runs too fast, decrease it. Normally it will not have an effect if you increase by more than 20%.</p>
      <p><img src="DispatcherSystem_files/image022.png" alt="A screenshot of a computer error
Description automatically generated" width="255" height="117" border="0"/></p>
      <h3><a name="_Toc167983238"></a><a name="_Toc168507355"></a><a name="_Toc192448859"></a>Setup two or more trains
        at once</h3>
      <p>If you wish to setup two or more trains at once, or if you always setup certain trains at a given starting
        position, an alternative way of proceeding is provided.</p>
      <p>Suppose we wish to setup trains at Siding 2 and Siding 3.</p>
      <p>Position trains in the blocks (or of simulation click the occupancy buttons to the bottom left of the red
        buttons).</p>
      <p><img src="DispatcherSystem_files/image023.png" alt="A diagram of a train
Description automatically generated" width="706" height="310" border="0"/></p>
      <p>Click Setup Trains as before:</p>
      <p><img src="DispatcherSystem_files/image016.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="697" height="119" border="0"/></p>
      <p>Click several trains. The following screen appears:</p>
      <p><img src="DispatcherSystem_files/image024.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="781" height="177" border="0"/></p>
      <p>Rows appear for the two blocks that have non-allocated trains.</p>
      <p>Select the trains from the dropdown menus</p>
      <p>Click -&gt; means click the direction Facing selection box in the next column. When this is clicked, the next
        block to the occupied block is highlighted as before and the directions selected populate the set Direction
        column. The Length and Speed Factor can be changed by editing the values given.</p>
      <p><img src="DispatcherSystem_files/image025.png" alt="A screenshot of a computer screen
AI-generated content may be incorrect." width="782" height="180" border="0"/></p>
      <p>Click Save, and the trains will be shown in the panel.</p>
      <p><img src="DispatcherSystem_files/image026.png" alt="" width="701" height="302" border="0"/></p>
      <h3><a name="_Toc192448860"></a>Saving and Retrieving Results from File</h3>
      <p>It gets a bit tedious entering the details for trains a lot, so the results can be saved to file, and
        retrieved. Before saving click the Save to File button.</p>
      <p><img src="DispatcherSystem_files/image027.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="498" height="353" border="0"/></p>
      <p>Enter the required name (no need to put the .txt suffix on) and press save.</p>
      <p>To load the saved file click the load button, and if the folder gets messy use the delete saved file
        option.</p>
      <p><img src="DispatcherSystem_files/image028.png" alt="" width="495" height="354" border="0"/></p>
      <h3><a name="_Toc192448861"></a>Modify existing trains</h3>
      <p>This option allows trains to be modified or at least viewed that have already been setup. Press the button, and
        modify the trains as required. Previously setup trains can be saved as per the previous step.</p>
      <h2><a name="_Toc168507356"></a><a name="_Toc192448862"></a><a name="_Toc167983239"></a>Dispatch or run a train
        directly</h2>
      <p>To set up a dispatch a train must have been registered with the system, as described in the previous section,
        and located in a stop.</p>
      <p>Click the Run Dispatcher System and the following prompt appears.</p>
      <p><img src="DispatcherSystem_files/image029.png" alt="A screenshot of a computer error
AI-generated content may be incorrect." width="256" height="121" border="0"/></p>
      <p>Click OK.</p>
      <p>Clicking the red station buttons when the Run Dispatch option is selected will allow a train to run between any
        two stations. The shortest route (using the lengths of the blocks) will be found. If the route requires the
        train to reverse then the system will cope with this. There are two options allowed Express where the train
        stops at the minimum stations possible or stopping when the train stops at all stations en-route. We will be
        running the train in express mode.</p>
      <p><img src="DispatcherSystem_files/image030.png"  width="284" height="158" border="0"/></p>
      <p>If you wish to run in stopping mode deselect the above buttion.</p>
      <h3><a name="_Toc168507357"></a><a name="_Toc192448863"></a>Example: Run a train between two stops (stations)</h3>
      <p>Suppose one has the following layout with a train in siding1. Suppose we wish to move the train to Upline
        Platform (near the bottom left of the panel).</p>
      <p><img src="DispatcherSystem_files/image031.png"  width="815" height="447" border="0"/></p>
      <p>To move the train to a station, click the destination station, ensuring first that the option Run Dispatch is
        selected (this option is selected at startup, but may be deselected if other operations have been utilised.</p>
      <p><img src="DispatcherSystem_files/image032.png"  width="207" height="236" border="0"/></p>
      <p>We wish to move train class 121 from Siding 1 to UpLinePlatform. Click the UplinePlatform button. A prompt
        appears with the trains registered on the system. Select the one you wish to move and press the mode you wish
        the train to move in express (stopping in the minimum number of stops) or stopping (stopping at all stations
        en-route).</p>
      <p><img src="DispatcherSystem_files/image033.png"  width="258" height="159" border="0"/></p>
      <p>Select the required train from the drop down, and a dispatch will be set up to the required stop
        (UpLinePlatform).</p>
      <p><img src="DispatcherSystem_files/image034.png"  width="814" height="542" border="0"/></p>
      <p>The train will start moving, and the speed indicated in the Auto trains window.</p>
      <p><img src="DispatcherSystem_files/image035.png"  width="422" height="146" border="0"/></p>
      <p>If you are simulating the movement of the train, then the Simulate Dispatched Trains button must be selected
        before the simulated movement starts.</p>
      <p><img src="DispatcherSystem_files/image036.png"  width="281" height="216" border="0"/></p>
      <h1><a name="_Toc168507358"></a><a name="_Toc192448864"></a>Routes</h1>
      <p>If you wish to do something more complicated that stop at no stations or all, then routes are useful. With
        routes you can specify several places that the train will stop off at en-route to the destination, and not just
        all or none.</p>
      <h2><a name="_Toc162537051"></a><a name="_Toc167983240"></a><a name="_Toc168507359"></a><a
              name="_Toc192448865"></a>Setup a Route</h2>
      <p><img src="DispatcherSystem_files/image037.png"  width="273" height="399" border="0"/></p>
      <p>Click 'Setup Route'. Run Dispatch will be deselected, and Setup Route Selected. The following message will be
        displayed:</p>
      <p><img src="DispatcherSystem_files/image038.png" alt="A screenshot of a computer screen
Description automatically generated" width="260" height="117" border="0"/></p>
      <p>Suppose we wish to send a train from Siding One to Upline Platform stopping at CornerUp</p>
      <p>We need to select the following stations in order</p>
      <p>&middot; Siding One</p>
      <p>&middot; Corner Up</p>
      <p>&middot; Up Line Platform</p>
      <p>Select Siding One. The following popup will be displayed</p>
      <p><img src="DispatcherSystem_files/image039.png"  width="415" height="120" border="0"/></p>
      <p>Actions or special scripts can be run at stations of a route. We will describe these later. Select &lsquo;Select
        another station, and press Corner Up station</p>
      <p>We get the following:</p>
      <p><img src="DispatcherSystem_files/image040.png"  width="587" height="123" border="0"/></p>
      <p>Press Select another station, click UpLinePlatform, then press Complete Route. The route is created and
        confirmation is acknowledged.</p>
      <p><img src="DispatcherSystem_files/image041.png"  width="653" height="118" border="0"/></p>
      <p>Another route may be created, or here we press Finish selecting routes. The setup Route button is deselected.
        To run a dispatch or setup another route the appropriate button must be selected.</p>
      <h2><a name="_Toc168507360"></a><a name="_Toc192448866"></a>View/Edit Routes</h2>
      <h3><a name="_Toc168507361"></a><a name="_Toc192448867"></a>View Routes</h3>
      <p>To see the route that has been created press View/Edit Routes</p>
      <p><img src="DispatcherSystem_files/image042.png"  width="200" height="182" border="0"/></p>
      <p>You will see something like this:</p>
      <p><img src="DispatcherSystem_files/image043.png"  width="452" height="319" border="0"/></p>
      <p>If you press Toggle Scheduled Routes you will see only the scheduled routes. Suppose we had two scheduled
        routes (see later for description) you would get the following when pressing that button. If you have no
        scheduled routes then you will get a blank window.</p>
      <p><img src="DispatcherSystem_files/image044.png" alt="A screenshot of a computer screen
Description automatically generated" width="448" height="193" border="0"/></p>
      <p>Click the edit button in the row of Siding One FY_to_UplinePlatform and you see:</p>
      <p><img src="DispatcherSystem_files/image045.png"  width="697" height="200" border="0"/></p>
      <p>The amount of time spent at each station (Duration) is seconds and fast minutes are needed to calculate the
        Departure time required for scheduling trains. These are not needed at this stage so we ignore them.</p>
      <p>&middot; For now, note that the route stops at the stations we requested, <a name="_Toc162537052"></a><a
              name="_Toc167983241"></a>Siding One. Corner Up and Up Line Platform.</p>
      <h3><a name="_Toc168507362"></a><a name="_Toc192448868"></a>Editing the route</h3>
      <p>If you wish to delete a station from a route you may select the route as shown in the previous section, and
        press the delete row check box for the station you want to delete.</p>
      <p>For example clicking the delete box for CornerUp will give you:</p>
      <p><img src="DispatcherSystem_files/image046.png"  width="700" height="175" border="0"/></p>
      <p>Which does not stop at CornerUp.</p>
      <p>If you wish to add a station, no facility to do this is given within Dispatcher System per se, and the advised
        action is to build another route from scratch. </p>
      <p>Note: For Experts: Dispatcher System uses Operations Pro to create routes, and the routes can be edited more
        fully within Operations Pro: Routes</p>
      <h2><a name="_Toc168507363"></a><a name="_Toc192448869"></a>Run Route</h2>
      <p>To run a route a route must already have been set up. Click Run Route</p>
      <p><img src="DispatcherSystem_files/image047.png"  width="251" height="413" border="0"/></p>
      <p><img src="DispatcherSystem_files/image048.png"  width="261" height="121" border="0"/></p>
      <p>You will be prompted to run one or several routes at once.</p>
      <h3><a name="_Toc168507364"></a><a name="_Toc192448870"></a>Run One Route</h3>
      <p>Select 1 route, You are prompted with the train to move. If the train is not at the start of the route it will
        move to the start before running the rout.</p>
      <p>You will be prompted with all the trains you have set up</p>
      <p><img src="DispatcherSystem_files/image049.png"  width="260" height="147" border="0"/></p>
      <p>Choose the train class 121, a list of routes are displayed. </p>
      <p><img src="DispatcherSystem_files/image050.png"  width="486" height="210" border="0"/></p>
      <p>Select show routes stating at train position.</p>
      <p><img src="DispatcherSystem_files/image051.png" alt="A screenshot of a computer error
Description automatically generated" width="261" height="123" border="0"/></p>
      <p>We see that train class 121 is at the starting position of route Siding One FY_to_UplinePlatform. </p>
      <p>Select OK.</p>
      <p><img src="DispatcherSystem_files/image052.png"  width="256" height="169" border="0"/></p>
      <p>Select whether you want to</p>
      <p>&middot; Run the route and stop</p>
      <p>&middot; Run the route and return to the start position (not necessarily along the same route, but the shortest
        route)</p>
      <p>&middot; Run the route, return to the start position and repeat</p>
      <p>We will select stop at end of route</p>
      <p>The train route is setup and the train starts moving along the route.</p>
      <h3><a name="_Toc168507365"></a><a name="_Toc192448871"></a>Run Several Routes at Once</h3>
      <p>Click Run Route. You are prompted for</p>
      <p><img src="DispatcherSystem_files/image048.png"  width="261" height="121" border="0"/></p>
      <p>Click several routes</p>
      <p><img src="DispatcherSystem_files/image053.png"  width="800" height="244" border="0"/></p>
      <p>The above panel appears populated with a row for each train that has been setup in the previous section.
        Allocate routes to each of the trains that you wish to move. The default is for the train to wait 10 seconds
        before moving the train. Change this as required. If the task chosen for a train is to make several repetitions,
        the no of repetitions in the last column will be used. We may specify for example</p>
      <p><img src="DispatcherSystem_files/image054.png" alt="A screenshot of a computer program
Description automatically generated" width="803" height="245" border="0"/></p>
      <p>Note that the trains will move in the order J94, Class_20, Class 121, and the route SP-SPUR_to_SP-Spur will
        repeat 3 times.</p>
      <p>Note that Class_20 will run its route Starting from Siding One, whereas J94 will move to SP-MLD first then run
        the route from SP-MLD to Parcels Siding, similarly Class 121 will travel to SP-SPUR before running the
        route.</p>
      <p>We will go over both options: &lsquo;Several routes&rsquo; is used to run several routes setting off at the
        same time.</p>
      <h1><a name="_Toc168507366"></a><a name="_Toc192448872"></a>Modifying the Behaviour of Running Trains</h1>
      <p>Provision is made to:</p>
      <p>&middot; Change the position where the trains stop, (using a stopping sensor or vary the calculated stopping
        length)</p>
      <p>&middot; Change the wait time in each station</p>
      <p>&middot; Set track to one way operation</p>
      <p>&middot; Stop transits starting for certain conditions. This will allow you to ensure that trains do not get
        trapped by other trains</p>
      <p><img src="DispatcherSystem_files/image055.png" alt="" width="270" height="399" border="0"/></p>
      <p>The buttons Set Stopping Length through to Restrict Transit Operation are used.</p>
      <h2><a name="_Toc168507367"></a><a name="_Toc192448873"></a>Set Stopping Length</h2>
      <p>When a train stops at a station the stopping distance is calculated using the lengths of the blocks in the last
        section. If the train stops short or overruns, this distance can be changed.</p>
      <p>Click Set Stopping length.</p>
      <p><img src="DispatcherSystem_files/image056.png" alt="" width="381" height="117" border="0"/></p>
      <p>The option is given to modify the stopping distances for all transits or just the stopping distance for one
        transit (from one station to another)</p>
      <h3><a name="_Toc168507368"></a><a name="_Toc192448874"></a>Modify All Stopping Distances</h3>
      <p>This modifies the stopping distance for all transits. Press All.</p>
      <p><img src="DispatcherSystem_files/image057.png"  width="627" height="118" border="0"/></p>
      <p>You may either </p>
      <p>&middot; increase or decrease existing stopping distances by the same amount, or </p>
      <p>&middot; delete any existing stopping distance changes, and increase or decrease existing stopping distances by
        the same amount</p>
      <p>If we keep existing changes, but modify by a bit, press Increase/decrease all existing stopping distances</p>
      <p><img src="DispatcherSystem_files/image058.png" alt="A screenshot of a computer error message
Description automatically generated" width="457" height="121" border="0"/></p>
      <p>Enter the amount to decrease the stopping distance by</p>
      <p><img src="DispatcherSystem_files/image059.png" alt="" width="453" height="115" border="0"/></p>
      <p>The train will now stop 5 cm short of the previous calculated position.</p>
      <p>Setting all stopping distances to the same value is similar.</p>
      <h3><a name="_Toc168507369"></a><a name="_Toc192448875"></a>Modify Stopping Distance on one Transit</h3>
      <p><img src="DispatcherSystem_files/image056.png" alt="" width="381" height="117" border="0"/></p>
      <p>Click From One Station to Another.</p>
      <p><img src="DispatcherSystem_files/image060.png"  width="351" height="193" border="0"/></p>
      <p>You need to specify a transit going towards the station, so we select two stations, the first the start of the
        transit, the second the end.</p>
      <p>Suppose we want to change the stopping distance for transit going from SP_MLU to DownLinePlatform. </p>
      <p>Select SP_MLU,</p>
      <p><img src="DispatcherSystem_files/image061.png" alt="A screenshot of a computer error
Description automatically generated" width="474" height="118" border="0"/></p>
      <p>then DownlinePlatform.</p>
      <p><img src="DispatcherSystem_files/image062.png"  width="568" height="122" border="0"/></p>
      <p>Click Modify Length</p>
      <p><img src="DispatcherSystem_files/image063.png"  width="548" height="235" border="0"/></p>
      <p>Specify the distance that the train will stop short of the calculated stopping distance </p>
      <h2><a name="_Toc168507370"></a><a name="_Toc192448876"></a>Set Stop Sensor</h2>
      <p><img src="DispatcherSystem_files/image064.png" alt="A list of different types of vehicles
Description automatically generated with medium confidence" width="246" height="142" border="0"/></p>
      <p>Click Set Stop Sensor</p>
      <p><img src="DispatcherSystem_files/image065.png"  width="474" height="120" border="0"/></p>
      <p>Suppose we wish to set stop sensor SidingLowerStopSensor at station Siding Lower FY, to operate when going in
        the direction Siding2Down to Siding Lower FY.</p>
      <p><img src="DispatcherSystem_files/image066.png" alt="A black and white image of a black and white arrow
Description automatically generated" width="730" height="133" border="0"/></p>
      <p>Click Set at particular station</p>
      <p><img src="DispatcherSystem_files/image067.png" alt="A screenshot of a computer screen
Description automatically generated" width="632" height="201" border="0"/></p>
      <p>To specify the direction first click scenic2Down </p>
      <p><img src="DispatcherSystem_files/image068.png" alt="A screenshot of a computer error
Description automatically generated" width="521" height="118" border="0"/></p>
      <p>Press &lsquo;select next station&rsquo; then then the station containing the stop sensor, Siding Lower FY</p>
      <p><img src="DispatcherSystem_files/image069.png" alt="A screenshot of a computer error
Description automatically generated" width="531" height="117" border="0"/></p>
      <p>Click Set stop Sensor</p>
      <p><img src="DispatcherSystem_files/image070.png" alt="A screenshot of a computer error message
Description automatically generated" width="343" height="116" border="0"/></p>
      <p>Select the required stop sensor from the dropdown, in our case SidingLowerStopSensor and click OK</p>
      <p>The set stop sensor routine finishes</p>
      <p>To check that you have set the sensor correctly select Set Stop Sensor again</p>
      <p><img src="DispatcherSystem_files/image071.png"  width="474" height="123" border="0"/></p>
      <p>It shows correctly that the section SD_FYa:SectorPlate3a has the stop sensor SidingLowerStopSensor. All trains
        stopping at that section will stop at the stop sensor, provided the &ldquo;Stop at Stop Sensos (Default )&rdquo;button
        is enabled</p>
      <p><img src="DispatcherSystem_files/image072.png"  width="257" height="254" border="0"/></p>
      <h2><a name="_Toc168507371"></a><a name="_Toc192448877"></a>Set Station Wait Time</h2>
      <p>The station wait times may be modified for all stations / stops, or at particular stations.</p>
      <p>Click &lsquo;Set Station Wait Time&rsquo;</p>
      <p><img src="DispatcherSystem_files/image073.png"  width="222" height="139" border="0"/></p>
      <p>The following screen appears</p>
      <p><img src="DispatcherSystem_files/image074.png"  width="288" height="110" border="0"/></p>
      <h3><a name="_Toc168507372"></a><a name="_Toc192448878"></a>Modify all station wait times</h3>
      <p>Click All</p>
      <p>The following screen appears</p>
      <p><img src="DispatcherSystem_files/image075.png"  width="614" height="114" border="0"/></p>
      <p>Either increase/decrease all wait times by same amount, or set all to same value</p>
      <p>If setting to same value, click appropriate button, the following appears:</p>
      <p><img src="DispatcherSystem_files/image076.png" alt="A screenshot of a computer error
Description automatically generated" width="283" height="118" border="0"/></p>
      <p>Set the number of seconds to wait at station, and click OK</p>
      <p><img src="DispatcherSystem_files/image077.png"  width="264" height="118" border="0"/></p>
      <p>Click OK</p>
      <h3><a name="_Toc168507373"></a><a name="_Toc192448879"></a>Modify the wait time at a particular station approach
      </h3>
      <p>Click &lsquo;At particular station&rsquo;. The following screen appears:</p>
      <p><img src="DispatcherSystem_files/image078.png"  width="493" height="166" border="0"/></p>
      <p>Click a station on the approach to the station whose wait time we want to set.</p>
      <p><img src="DispatcherSystem_files/image079.png" alt="A black and white image of a black and white object
Description automatically generated with medium confidence" width="529" height="85" border="0"/></p>
      <p>Suppose we wish to set the wait time at station Downline Platform from direction SP-MLU. Click SP-MLU</p>
      <p><img src="DispatcherSystem_files/image080.png" alt="A screenshot of a computer error
Description automatically generated" width="482" height="114" border="0"/></p>
      <p>Select station DownLinePlatform</p>
      <p><img src="DispatcherSystem_files/image081.png"  width="494" height="114" border="0"/></p>
      <p>Click Modify Station Wait Time</p>
      <p><img src="DispatcherSystem_files/image082.png" alt="A screenshot of a computer error message
Description automatically generated" width="551" height="173" border="0"/></p>
      <p>The value is 5 (from the previous action of setting all wait times), set it to 3 say </p>
      <p><img src="DispatcherSystem_files/image083.png"  width="254" height="115" border="0"/></p>
      <h2><a name="_Toc168507374"></a><a name="_Toc192448880"></a>Set Station Direction</h2>
      <h3><a name="_Toc168507375"></a><a name="_Toc192448881"></a>Setting Station Direction at a Station</h3>
      <p>The setting of station direction is best illustrated by an example.</p>
      <p>On the following UK layout we wish to go from Siding One to UplinePlatform Via CornerUp, because we travel on
        the left, but the shortest route is via CornerDown. To make the train travel via Corner Up we have to make
        travel at CornerDown station one way in the direction of Siding One.</p>
      <p>If you are happier you could enforce one-way working at both CornerUp and CornerDown, but the above argument
        shows that we only need to do so at the leg with the shorter length.</p>
      <p><img src="DispatcherSystem_files/image084.png"  width="874" height="555" border="0"/></p>
      <p><strong>Setting the direction at CornerDown.</strong></p>
      <p>Click Set Station Direction</p>
      <p><img src="DispatcherSystem_files/image085.png"  width="538" height="120" border="0"/></p>
      <p>Click Set at particular station</p>
      <p><img src="DispatcherSystem_files/image086.png"  width="412" height="134" border="0"/></p>
      <p>Click CornerDown</p>
      <p><img src="DispatcherSystem_files/image087.png" alt="A screenshot of a computer error
Description automatically generated" width="481" height="115" border="0"/>&nbsp;</p>
      <p>Select Scenic2Down</p>
      <p><img src="DispatcherSystem_files/image088.png" alt="" width="1167" height="114" border="0"/></p>
      <p>Click Allow only the direction from CornerDown towards Scenic2Down.</p>
      <p>The one way working is stored in the Train Info files. These are regenerated.</p>
      <p><img src="DispatcherSystem_files/image089.png"  width="260" height="114" border="0"/></p>
      <p>To confirm what we have done, Click Set the StationWaitTime Button again</p>
      <p><img src="DispatcherSystem_files/image090.png"  width="207" height="143" border="0"/></p>
      <p><img src="DispatcherSystem_files/image091.png"  width="536" height="121" border="0"/></p>
      <p>We see we have set one-way working in the direction CornerDown to Scenic2Down</p>
      <h3><a name="_Toc168507376"></a><a name="_Toc192448882"></a>Setting the Station Direction using a block</h3>
      <p>This is used where there is no station in the area required to be one way working, no possibility of putting
        one in (the area contains a turnout) without putting in extra blocks, or just no desire to have a station in the
        area. </p>
      <p>The system of setting station direction using a block was designed for a system where the area of one way
        working had no possibility of putting a station in, but we will illustrate it by setting the block containing
        the station CornerUp to one way working, assuming that the stations Scenic2Up, CornerUp and ML-MLD do not
        exist.</p>
      <p><img src="DispatcherSystem_files/image092.png" alt="A map of a train
Description automatically generated with medium confidence" width="481" height="628" border="0"/></p>
      <p>The block CornerUp is highlighted.</p>
      <p>Click Set Station Direction</p>
      <p><img src="DispatcherSystem_files/image093.png"  width="536" height="122" border="0"/></p>
      <p>Then click Set At Block, </p>
      <p><img src="DispatcherSystem_files/image094.png" alt="A screenshot of a computer error message
Description automatically generated" width="373" height="132" border="0"/></p>
      <p>Click OK</p>
      <p><img src="DispatcherSystem_files/image095.png"  width="254" height="777" border="0"/></p>
      <p>select block CornerUp, then click OK</p>
      <p>The two neighbouring blocks are shown</p>
      <p><img src="DispatcherSystem_files/image096.png"  width="256" height="129" border="0"/></p>
      <p>Select ML-MLD</p>
      <p><img src="DispatcherSystem_files/image097.png" alt="A screen shot of a computer
Description automatically generated" width="1017" height="126" border="0"/></p>
      <p>Click Allow only the direction from CornerUp towards ML-MLD (UK trains run on the lefthand side.</p>
      <p>The trainInfo Files are regenerated, and if one clicks Set the StationWaitTime Button again</p>
      <p><img src="DispatcherSystem_files/image090.png"  width="207" height="143" border="0"/></p>
      <p>You get </p>
      <p><img src="DispatcherSystem_files/image098.png"  width="538" height="132" border="0"/></p>
      <p>Click x to close.</p>
      <h2><a name="_Toc168507377"></a><a name="_Toc192448883"></a>Restrict Transit Operation</h2>
      <h3><a name="_Toc168507378"></a><a name="_Toc192448884"></a>Introduction</h3>
      <p>This operation is best described by an example. Consider the following layout:</p>
      <p><img src="DispatcherSystem_files/image099.png" alt="A screenshot of a video game
Description automatically generated" width="551" height="142" border="0"/></p>
      <p>DownLinePlatform and UpLinePlatform are terminus stations (with a traverser at the end hence the continuations
        to the left). There is no easy way to set up a Traverser at the moment under Dispatcher, though it can be done
        with points and some Logix),<br/> <br/> Consider the situation where trains are in Down and UpLinePlatforms. We
        are in the UK where trains travel on the left, and the train in UplinePlatform wants to move to
        DownlinePlatform, where it will pick up passengers before travelling in SP-MLU direction. To do this it will
        travel to SP-MLU and then to UplinePlatform.</p>
      <p>If there is a train in UplinePlatform, this train will be trapped by the train in SP-MLU. To avoid this we need
        a rule, do not go on the journey UplinePlatform &ndash; SP-MLU &ndash; DownLinePlatform if there is a train in
        DownLinePlatform.</p>
      <h3><a name="_Toc168507379"></a><a name="_Toc192448885"></a>Creating the required Rule</h3>
      <p><img src="DispatcherSystem_files/image100.png"  width="234" height="141" border="0"/></p>
      <p>Click Restrict Transit Operation</p>
      <p><img src="DispatcherSystem_files/image101.png" alt="A screenshot of a computer error
Description automatically generated" width="527" height="117" border="0"/></p>
      <p>Click Set Transit Restriction</p>
      <p><img src="DispatcherSystem_files/image102.png" alt="A screenshot of a computer error
Description automatically generated" width="318" height="114" border="0"/></p>
      <p>Click OK, Select the start and end of the transit.</p>
      <p>Click UpLinePlatform</p>
      <p><img src="DispatcherSystem_files/image103.png" alt="A screenshot of a computer error
Description automatically generated" width="430" height="115" border="0"/></p>
      <p>Click Nest Station, and Click DownLinePlatform.</p>
      <p><img src="DispatcherSystem_files/image104.png"  width="497" height="112" border="0"/></p>
      <p>We get an error. Our reasoning is incorrect we must select SP-MLU, and apply a rule:</p>
      <p>Do not go on the journey DownlinePlatform-SP-MLU if UplinePlatform is occupied</p>
      <p>Select TryAgain, and Select SP-MLU</p>
      <p><img src="DispatcherSystem_files/image105.png" alt="A screenshot of a computer error
Description automatically generated" width="453" height="113" border="0"/></p>
      <p>Press Select Station to Select its Block. Select Station UpLinePlatform</p>
      <p><img src="DispatcherSystem_files/image106.png" alt="A screenshot of a computer error
Description automatically generated" width="442" height="133" border="0"/></p>
      <p>Click Restrict This Transit</p>
      <p>To see what we have done, click Restrict Transit Operation again and we get:</p>
      <p><img src="DispatcherSystem_files/image107.png" alt="A close-up of words
Description automatically generated" width="213" height="66" border="0"/></p>
      <p><img src="DispatcherSystem_files/image108.png" alt="A screenshot of a computer error
Description automatically generated" width="603" height="121" border="0"/></p>
      <p>If you have made a mistake, remove the transit restriction, otherwise Click Cancel</p>
      <h1><a name="_Toc167983246"></a><a name="_Toc168507380"></a><a name="_Toc192448886"></a>Scheduling</h1>
      <p>Trains can be scheduled to run at specific times over routes. In the schedule table the trains on the routes
        are set to run at specific start times. They can then be set to run just at that time or at intervals based on
        that start time, say every 20 minutes.</p>
      <p>The running period per day can be set from say 4am to 11pm, and the fast clock set to a rate within that
        period, and optionally at a faster rate outside that period (during the night).</p>
      <p>Timetables can be set up to display the schedules trains, For timetables to work the start time of each station
        on each route that is scheduled needs to be set up. This can be done manually or automatically, the latter by
        running a train over he route using a special routine.</p>
      <p>Timetables can be displayed locally on the computer running JMRI, or on remote computers/tablets communicating
        via MQTT usually over a local network.</p>
      <p>The schedules are set up from the Dispatcher panel. At the bottom of the panel you see the following
        screen.</p>
      <p><img src="DispatcherSystem_files/image109.png" alt="A screenshot of a computer program
Description automatically generated" width="223" height="197" border="0"/></p>
      <p>Click &ldquo;View/Edit Scheduled Trains&rdquo; and a screen pops up similar to the following:</p>
      <p><img src="DispatcherSystem_files/image110.png" alt="" width="995" height="110" border="0"/></p>
      <h2><a name="_Toc167983248"></a><a name="_Toc168507381"></a><a name="_Toc192448887"></a>Adding Schedules</h2>
      <p>Press the Add button. A row is added to the screen</p>
      <p><img src="DispatcherSystem_files/image111.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="998" height="146" border="0"/></p>
      <p>Press the dropdown for route</p>
      <p><img src="DispatcherSystem_files/image112.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="999" height="234" border="0"/></p>
      <p>Select one of the routes that have been set up. We select Siding One FY to UpLinePlatform.</p>
      <p>Press the dropdown for Repeat</p>
      <p><img src="DispatcherSystem_files/image113.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="998" height="175" border="0"/></p>
      <p>We have the options of running just at the given time, or repeat at given frequencies, Once, Every 20 mins,
        Every 30mins, Every Hour, or Every 2 hours. We would like the train to repeat every 30 mins, so we select
        that.</p>
      <p>Set the time. The hour is ignored if we are running at a set frequency, so we can leave it at 00, (note if we
        have set to Once, the hour is used). We set the minutes to say 2 minutes past the hour so the train will run a 2
        and 32 minutes past the hour. Double click the time to set.</p>
      <p><img src="DispatcherSystem_files/image114.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="999" height="146" border="0"/></p>
      <p>Select the train that will be running on the schedule</p>
      <p><img src="DispatcherSystem_files/image115.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="994" height="252" border="0"/></p>
      <p>Edit Route displays the stations on the route, and allows us to enter dispatch times, which will be explained
        later. </p>
      <p>Delete Row deletes the row without warning, so if you have several trains dispatched, it may be best to save
        these to file to avoid having to type them in again.</p>
      <p>Delete all Rows does what it says.</p>
      <p>The Repeat button toggles all the entries through <a name="_Toc167983249"></a><a name="_Toc168507382"></a>Once,
        Every 20 mins, Every 30mins, Every Hour, or Every 2 hours </p>
      <p>Save to File saves the entries to file, Load from File allows you to load previously saved schedules, and wipes
        out existing ones</p>
      <p>Delete Saved Files enables you to only have saved the files that you want.</p>
      <p>Saving Schedules</p>
      <p>Click the save button to save the schedule. Only valid complete rows are saved.</p>
      <h2><a name="_Toc167983253"></a><a name="_Toc168507386"></a><a name="_Toc192448888"></a>To save the set of
        scheduled trains</h2>
      <p>Press save to file, and select an appropriate file name</p>
      <p><img src="DispatcherSystem_files/image116.png"  width="258" height="115" border="0"/></p>
      <p>Only complete valid rows are saved</p>
      <p><img src="DispatcherSystem_files/image117.png"  width="490" height="350" border="0"/></p>
      <p>Save to my_saved_file_1</p>
      <h2><a name="_Toc167983254"></a><a name="_Toc168507387"></a><a name="_Toc192448889"></a>To retrieve a set of
        scheduled trains</h2>
      <p>Press Load from File. Beware this will overwrite the existing schedules. It may be advisable to save the
        existing schedules to file before doing this.</p>
      <p><img src="DispatcherSystem_files/image118.png"  width="497" height="348" border="0"/></p>
      <p>Click the required file (here there is only one). The saved file will be loaded.</p>
      <h1><a name="_Toc168507388"></a><a name="_Toc192448890"></a>Setting Departure Times</h1>
      <p>If departure times are set for stations on a route, then the trains will wait till the departure time, before
        setting off. Also the departure times will be shown on any timetable for that station</p>
      <h2><a name="_Toc167983255"></a><a name="_Toc168507389"></a><a name="_Toc192448891"></a>Setting Departure Times
        Manually</h2>
      <p>Click Setup departure Times</p>
      <p><img src="DispatcherSystem_files/image119.png" alt="A white background with black text
Description automatically generated" width="238" height="113" border="0"/></p>
      <p>Then click set departure times</p>
      <p><img src="DispatcherSystem_files/image120.png" alt="A screen shot of a computer
Description automatically generated" width="708" height="113" border="0"/></p>
      <p>If we set departure times for stations along a route, then the train will not depart from the station before
        the departure time.</p>
      <p><img src="DispatcherSystem_files/image121.png"  width="695" height="215" border="0"/></p>
      <p>Note that we are running at the default fast clock 1:10.</p>
      <p>Note that if actions such as bell.py are present in the route, no departure times or durations are indicated
        for these.</p>
      <p>The duration is defined as the time the train takes to travel between the previous station and the current
        station plus the wait time in the station. It is displayed in real seconds and fast minutes. The departure time
        is calculated automatically from the durations (and vice-versa). </p>
      <p>We can either enter the journey times in real seconds, or the durations in fast minutes</p>
      <p>We could now run a train over the route, measure the time taken, and enter the durations in fast minutes.
        Alternatively, you can note the time the train arrives at the station, and add a bit to allow the train to
        wait. </p>
      <p>For example we enter 3 and 5 for the durations in fast minutes and toggle journey/wait times to get:</p>
      <p><img src="DispatcherSystem_files/image122.png"  width="701" height="242" border="0"/></p>
      <p>The departure times or durations update automatically. </p>
      <p>We note that if we enter durations in seconds they are rounded down to the lowest 6 seconds</p>
      <p>If you experiment you see that you can toggle the journey/wait times once more and enter the journey times in
        seconds</p>
      <h2><a name="_Toc167983256"></a><a name="_Toc168507390"></a><a name="_Toc192448892"></a>Setting Departure Times
        Automatically</h2>
      <p>To make it easier to obtain the durations the train can be run over the route, and the durations recoded
        automatically. The wait time in all or individual stations can be set so that the duration can be calculated
        (journey time + wait time) and stored.</p>
      <p><img src="DispatcherSystem_files/image123.png" alt="A list of tasks with text
Description automatically generated with medium confidence" width="249" height="169" border="0"/></p>
      <p>To do this press Setup Departure Times. You get the options:</p>
      <p><img src="DispatcherSystem_files/image124.png"  width="671" height="120" border="0"/></p>
      <h3><a name="_Toc167983257"></a><a name="_Toc168507391"></a><a name="_Toc192448893"></a>Set Wait Time in Stations
      </h3>
      <p>This sets the default wait time in all stations. (in real secs). It can be overwritten in set departure times
        for a particular route.</p>
      <p><img src="DispatcherSystem_files/image125.png" alt="A screenshot of a computer screen
Description automatically generated" width="285" height="121" border="0"/></p>
      <p>Note that the wait time will be rounded in practice to the nearest fast minute. At 10 times normal speed 1 fast
        minute will equal 6 seconds.</p>
      <h3><a name="_Toc167983258"></a><a name="_Toc168507392"></a><a name="_Toc192448894"></a>Run Train on Route to Set
        Journey Times</h3>
      <p><img src="DispatcherSystem_files/image126.png"  width="711" height="116" border="0"/></p>
      <p>Pressing this option allows you to select a route to run. (An engine needs to be at the start of the route, and
        the engine need to be assigned using the setup button before running this routine).</p>
      <p><img src="DispatcherSystem_files/image127.png" alt="" width="198" height="66" border="0"/></p>
      <p>Pressing &ldquo;Run Train on Route to Set Journey Times&rdquo; brings up something like the following
        dialog:</p>
      <p><img src="DispatcherSystem_files/image128.png"  width="258" height="170" border="0"/></p>
      <p>Select Siding One FY_to_UplinePlatform </p>
      <p><img src="DispatcherSystem_files/image129.png"  width="706" height="539" border="0"/></p>
      <p>Click Check train in required station, ensuring first that a engine is setup in (in this case Siding One
        FY).</p>
      <p>The train will run over the route and record the time taken on each leg of the journey</p>
      <p><img src="DispatcherSystem_files/image130.png"  width="848" height="509" border="0"/></p>
      <p>After the train has run the journey times will be entered</p>
      <p><img src="DispatcherSystem_files/image131.png" alt="" width="696" height="383" border="0"/></p>
      <p>The procedure will be repeated for all routes for all scheduled trains</p>
      <h1><a name="_Toc167983259"></a><a name="_Toc168507393"></a><a name="_Toc192448895"></a>Run Scheduled Trains</h1>
      <p>To run the scheduled trains, we need to set up the running period in the day, then start the clock at the
        beginning of this period.</p>
      <p><img src="DispatcherSystem_files/image123.png" alt="A list of tasks with text
Description automatically generated with medium confidence" width="249" height="169" border="0"/></p>
      <p>Click the Start Scheduler Button. The following screen pops up:</p>
      <p><img src="DispatcherSystem_files/image132.png"  width="415" height="290" border="0"/></p>
      <p>The analogue clock also appears set to 00:00.</p>
      <h3><a name="_Toc167983260"></a><a name="_Toc168507394"></a><a name="_Toc192448896"></a>Initialisation: Change
        Running Period Parameters</h3>
      <p>Click &ldquo;Initialisation&rdquo;, A set of input boxes are displayed to enable setting of:</p>
      <p>&middot; The start of the running period</p>
      <p>&middot; The end of the running period</p>
      <p>&middot; The fast clock rate during the running period</p>
      <p>&middot; The fast clock rate outside the running period</p>
      <p>Defaults are set and can be left as is for initial testing</p>
      <h3><a name="_Toc167983261"></a><a name="_Toc168507395"></a><a name="_Toc192448897"></a>Start the Scheduled Trains
      </h3>
      <h3><a name="_Toc192448898"></a>1) Set the time to a period within the running period</h3>
      <p>Click &ldquo;Set Time&rdquo;, The clock moves to 5 minutes before the start of the running period. It moves to
        the start of the running period at the fast clock rate for outside running times, then at the start of the
        running period, it changes to the running period fast rate.</p>
      <h3><a name="_Toc192448899"></a>2) Start the scheduling of the trains</h3>
      <p>The trains will be scheduled according to the schedule table, and any timetables set up (see later) will be
        populated with the scheduled trains for the next 3 hours.</p>
      <h3><a name="_Toc192448900"></a>3) Start the clock</h3>
      <p>The clock is initialised to stop when the start scheduling button is pressed. Click Stop/Start to restart the
        clock.</p>
      <p>The trains will start scheduling</p>
      <h3><a name="_Toc167983262"></a><a name="_Toc168507396"></a><a name="_Toc192448901"></a>Stop Scheduling Trains
      </h3>
      <p>Click the Toggle button to stop scheduling trains and to restart scheduling</p>
      <h1><a name="_Toc167983263"></a><a name="_Toc168507397"></a><a name="_Toc192448902"></a>Timetables</h1>
      <p>A local timetable of any one station can be shown on the computer running JMRI. This is denoted as a local
        timetable.</p>
      <p>Timetables can also be shown on remote tablets/computers. These are denoted MQTT timetables as they communicate
        with each other using MQTT. </p>
      <p>Click the show timetable button.</p>
      <p><img src="DispatcherSystem_files/image123.png" alt="A list of tasks with text
Description automatically generated with medium confidence" width="249" height="169" border="0"/></p>
      <p>A popup allowing the choice between a local timetable and MQTT timetables. MQTT timetables require some setting
        up. The local timetable works straight away.</p>
      <p><img src="DispatcherSystem_files/image133.png" alt="A screenshot of a computer error
AI-generated content may be incorrect." width="626" height="158" border="0"/></p>
      <h2><a name="_Toc192448903"></a>Set Platforms and Station Groups</h2>
      <p>Press the &lsquo;set platforms and station groups&rsquo; button and a table pops up showing all the stations on
        the system.</p>
      <p><img src="DispatcherSystem_files/image134.png" alt="" width="578" height="779" border="0"/></p>
      <p>You may find like the example above that the station names are rather cryptic, and not names that you would
        want to appear on a timetable. Looking at the diagram you see that CornerUp and Corner Down are two platforms at
        one place Walden. It would be nice to display the trains going in each direction on one timetable with the name
        Walden, and show what platform each train stops at. To do this the details for Walden had been filled in under
        station group, and the platform details under platform.</p>
      <h2><a name="_Toc167983264"></a><a name="_Toc168507398"></a><a name="_Toc192448904"></a>Local Timetables</h2>
      <p>Select the button &ldquo;select station(s) for timetable. The following pops up:</p>
      <p><img src="DispatcherSystem_files/image135.png" alt="A screenshot of a program
AI-generated content may be incorrect." width="257" height="213" border="0"/></p>
      <p>Select the required station(s) that you want to display the timetable for. Note that only stations at which a
        train stops on a scheduled route are shown. (if a different station could be selected the displayed timetable
        would be blank).</p>
      <p>We have selected two stations here by using the control button (using Windows). Similar for Linux and Mac.</p>
      <p>A screen will be displayed reminding you that for timetables to be displayed the trains must be scheduled and
        the scheduler be running. If these conditions are satisfied you will get a timetable displayed</p>
      <p>You may thus get a message </p>
      <p><img src="DispatcherSystem_files/image136.png"  width="337" height="119" border="0"/></p>
      <p>In which case you need to ensure that the clock is running and the train scheduler is running by clicking the
        start scheduler button.</p>
      <p>A timetable similar to the below timetable will be shown:</p>
      <p><img src="DispatcherSystem_files/image137.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="879" height="378" border="0"/></p>
      <h2><a name="_Toc192448905"></a>Turning Timetables Off</h2>
      <p>You will find that as the local timetable is refreshed every fast minute, it pops up above all other windows.
        If you wish to stop the timetable showing, click the &lsquo;turn timetable off&rsquo; button.</p>
      <p><img src="DispatcherSystem_files/image138.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="831" height="154" border="0"/></p>
      <h2><a name="_Toc192448906"></a><a name="_Toc168507399"></a>Remote Timetables triggered by MQTT</h2>
      <p>To display a timetable on a remote tablet or computer screen, we need to:</p>
      <p>1) Set up the required MQTT environment using Mosquitto and Node Red on a local or remote computer</p>
      <p>2) Set up a local or remote network connection</p>
      <p>3) Setup a MQTT connection in JMRI</p>
      <p>4) Generate the MQTT Node Red Code</p>
      <p>5) Import the code to node red, and perform a trivial edit</p>
      <p>6) Get the appropriate page on a browser to display the timetable</p>
      <p>These timetables were inspired by a Rocrail MQTT implementation and modified from that implementation. The
        Rocrail implementation and hence the JMRI Node Red implementation is licenced as follows:&nbsp;<a
                href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">CC Attribution-Share Alike 4.0
          International</a>.</p>
      <h3><a name="_Toc192448907"></a>Generating the MQTT Node Red code</h3>
      <p>Click select station for MQTT timetable</p>
      <p><img src="DispatcherSystem_files/image139.png" alt="A screenshot of a computer
AI-generated content may be incorrect." width="829" height="152" border="0"/></p>
      <p>Select the required station</p>
      <p><img src="DispatcherSystem_files/image140.png"  width="250" height="1" hspace="12"/><br clear="all"/></p>
      <p>Proision is made to display an icon on the timetable. At present you can add a British Rail logo, a Deutsches
        Bahn logo or none.</p>
      <p><img src="DispatcherSystem_files/image141.png"  width="287" height="153" border="0"/></p>
      <p>Select the logo required and click Generate Timetable. </p>
      <p>It is hoped that users will submit modifications to JMRI to add other emblems for different train
        operators.</p>
      <p>Notification that a node red file has been produced in the user files directory</p>
      <p><img src="DispatcherSystem_files/image142.png" alt="A screenshot of a computer error
Description automatically generated" width="905" height="210" border="0"/></p>
      <h3><a name="_Toc192448908"></a>Setting up the required Node Red environment</h3>
      <p>Set up a MQTT broker such as mosquito on the same machine as is running JMRI, or one that is connected on the
        same network. You may use the instructions given in <a href="https://mosquitto.org/">Eclipse Mosquitto</a> if
        desired.</p>
      <p>Set up Node Red as given in <a href="https://nodered.org/">Node-RED (nodered.org)</a>. Note that if you are
        using a raspberry pi, with some installations Node Red comes installed. Note that there are many tutorials on
        this site which give you a good introduction to Node-red.</p>
      <p>Start Node Red in a command file and start node-red in a browser using <a href="http://localhost:1880">http://localhost:1880</a>
        or similar. Import the node-red file generated in the previous section</p>
      <p><img src="DispatcherSystem_files/image143.png" alt="A screenshot of a black screen
Description automatically generated" width="166" height="346" border="0"/></p>
      <p><img src="DispatcherSystem_files/image144.png" alt="" width="356" height="300" border="0"/></p>
      <p><img src="DispatcherSystem_files/image145.png"  width="864" height="249" border="0"/></p>
      <p>If you get the message</p>
      <p><a name="_Toc162537054"></a><a name="_Toc167983243"></a><a name="_Toc168507400"></a><img
              src="DispatcherSystem_files/image146.png" alt="" width="496" height="112" border="0"/></p>
      <p>Click import copy</p>
      <p><img src="DispatcherSystem_files/image147.png" alt="A screenshot of a computer screen
Description automatically generated" width="1467" height="665" border="0"/></p>
      <p>Open the web socket node as detailed in the comment. In this case it is the node labelled [ws] /ws/CornerUp.
        Double click that node, and you will get something like:</p>
      <p><img src="DispatcherSystem_files/image148.png"  width="506" height="284" border="0"/></p>
      <p>The path will not have been set to the correct value. Click the pencil to the right of the path, and enter the
        correct value /ws/CornerUp in our case.</p>
      <p><img src="DispatcherSystem_files/image149.png" alt="" width="524" height="322" border="0"/></p>
      <p>Click Update Done and Deploy</p>
      <p><img src="DispatcherSystem_files/image150.png"  width="1471" height="658" border="0"/></p>
      <p>The blue dots will dissapear.</p>
      <h3><a name="_Toc192448909"></a>Setup a MQTT Connection in JMRI</h3>
      <p>A MQTT connection needs to be set up in JMRI to connect to the MQTT broker. Follow the instructions in the JMRI
        help. You will get something like:</p>
      <p><img src="DispatcherSystem_files/image151.png" alt="" width="643" height="388" border="0"/></p>
      <p>Reboot JMRI</p>
      <h3><a name="_Toc192448910"></a>Display the MQTT timetable</h3>
      <p>Display the MQTT timetable by going to a browser and displaying <a href="http://localhost:1880/StationName">http://localhost:1880/StationName</a>.
        For example if the station name is Siding One FY, then you enter <a
                href="http://localhost:1880/Siding%20One%20FY">http://localhost:1880/Siding One FY</a></p>
      <p>If the timetable does not appear ensure node-red is started, for example in windows</p>
      <p><img src="DispatcherSystem_files/image152.png" alt="A screenshot of a computer screen
Description automatically generated" width="830" height="176" border="0"/></p>
      <p>You should get something like:</p>
      <p><img src="DispatcherSystem_files/image153.png" alt="A screenshot of a computer screen
Description automatically generated" width="834" height="362" border="0"/></p>
      <h1><a name="_Toc192448911"></a>Adding New Stations or Track to a Completed Panel</h1>
      <p>To add a new station or track</p>
      <p>Edit the panel and add instructions to add any new stations:</p>
      <ul type="disc">
        <li>the new stations must be entered in the block table as described in a previous section</li>
        <li>open the new panel in panel editor, and change the panel to add new track and/or signals as required</li>
      </ul>
      <p>Run the dispatcher system</p>
      <ul type="disc">
        <li>open the new panel, and re-run dispatcher system. If you have created a version of Dispatcher system before,
          and the trains were running OK, then you do not have to run stage 2, just Stage 1
        </li>
        <li>All the previous stations and icons will be removed, and new ones added automatically</li>
      </ul>
      <p><img src="DispatcherSystem_files/image154.png" alt="A screenshot of a computer error
Description automatically generated" width="683" height="280" border="0"/></p>
      <p>Save the new panel, and restart JMRI.</p>
    </div><!-- closes #mainContent-->
  </div><!-- closes #mBody-->
</body>
</html>